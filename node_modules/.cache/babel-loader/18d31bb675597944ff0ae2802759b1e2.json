{"ast":null,"code":"/*\nCopyright (c) 2019 Daybrush\nname: @scena/dragscroll\nlicense: MIT\nauthor: Daybrush\nrepository: git+https://github.com/daybrush/dragscroll.git\nversion: 0.2.1\n*/\nimport Component from '@egjs/component';\nimport { now } from '@daybrush/utils';\n/*! *****************************************************************************\r\nCopyright (c) Microsoft Corporation. All rights reserved.\r\nLicensed under the Apache License, Version 2.0 (the \"License\"); you may not use\r\nthis file except in compliance with the License. You may obtain a copy of the\r\nLicense at http://www.apache.org/licenses/LICENSE-2.0\r\n\r\nTHIS CODE IS PROVIDED ON AN *AS IS* BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\r\nKIND, EITHER EXPRESS OR IMPLIED, INCLUDING WITHOUT LIMITATION ANY IMPLIED\r\nWARRANTIES OR CONDITIONS OF TITLE, FITNESS FOR A PARTICULAR PURPOSE,\r\nMERCHANTABLITY OR NON-INFRINGEMENT.\r\n\r\nSee the Apache Version 2.0 License for specific language governing permissions\r\nand limitations under the License.\r\n***************************************************************************** */\n\n/* global Reflect, Promise */\n\nvar _extendStatics = function extendStatics(d, b) {\n  _extendStatics = Object.setPrototypeOf || {\n    __proto__: []\n  } instanceof Array && function (d, b) {\n    d.__proto__ = b;\n  } || function (d, b) {\n    for (var p in b) if (b.hasOwnProperty(p)) d[p] = b[p];\n  };\n\n  return _extendStatics(d, b);\n};\n\nfunction __extends(d, b) {\n  _extendStatics(d, b);\n\n  function __() {\n    this.constructor = d;\n  }\n\n  d.prototype = b === null ? Object.create(b) : (__.prototype = b.prototype, new __());\n}\n\nfunction getDefaultScrollPosition(e) {\n  var container = e.container;\n  return [container.scrollLeft, container.scrollTop];\n}\n\nvar DragScroll = /*#__PURE__*/function (_super) {\n  __extends(DragScroll, _super);\n\n  function DragScroll() {\n    var _this = _super !== null && _super.apply(this, arguments) || this;\n\n    _this.startRect = null;\n    _this.startPos = [];\n    _this.prevTime = 0;\n    _this.timer = 0;\n    return _this;\n  }\n\n  var __proto = DragScroll.prototype;\n\n  __proto.dragStart = function (e, options) {\n    var _a = options.container.getBoundingClientRect(),\n        top = _a.top,\n        left = _a.left,\n        width = _a.width,\n        height = _a.height;\n\n    this.startPos = [e.clientX, e.clientY];\n    this.startRect = {\n      top: top,\n      left: left,\n      width: width,\n      height: height\n    };\n  };\n\n  __proto.drag = function (e, options) {\n    var _this = this;\n\n    var clientX = e.clientX,\n        clientY = e.clientY;\n    var container = options.container,\n        _a = options.threshold,\n        threshold = _a === void 0 ? 0 : _a,\n        _b = options.throttleTime,\n        throttleTime = _b === void 0 ? 0 : _b,\n        _c = options.getScrollPosition,\n        getScrollPosition = _c === void 0 ? getDefaultScrollPosition : _c;\n\n    var _d = this,\n        startRect = _d.startRect,\n        startPos = _d.startPos;\n\n    var nowTime = now();\n    var distTime = Math.max(throttleTime + this.prevTime - nowTime, 0);\n    var direction = [0, 0];\n\n    if (startRect.top > clientY - threshold) {\n      if (startPos[1] > startRect.top || clientY < startPos[1]) {\n        direction[1] = -1;\n      }\n    } else if (startRect.top + startRect.height < clientY + threshold) {\n      if (startPos[1] < startRect.top + startRect.height || clientY > startPos[1]) {\n        direction[1] = 1;\n      }\n    }\n\n    if (startRect.left > clientX - threshold) {\n      if (startPos[0] > startRect.left || clientX < startPos[0]) {\n        direction[0] = -1;\n      }\n    } else if (startRect.left + startRect.width < clientX + threshold) {\n      if (startPos[0] < startRect.left + startRect.width || clientX > startPos[0]) {\n        direction[0] = 1;\n      }\n    }\n\n    clearTimeout(this.timer);\n\n    if (!direction[0] && !direction[1]) {\n      return false;\n    }\n\n    if (distTime > 0) {\n      this.timer = window.setTimeout(function () {\n        _this.drag(e, options);\n      }, distTime);\n      return false;\n    }\n\n    this.prevTime = nowTime;\n    var prevPos = getScrollPosition({\n      container: container,\n      direction: direction\n    });\n    this.trigger(\"scroll\", {\n      container: container,\n      direction: direction,\n      inputEvent: e\n    });\n    var nextPos = getScrollPosition({\n      container: container,\n      direction: direction\n    });\n    var offsetX = nextPos[0] - prevPos[0];\n    var offsetY = nextPos[1] - prevPos[1];\n\n    if (!offsetX && !offsetY) {\n      return false;\n    }\n\n    this.trigger(\"move\", {\n      offsetX: direction[0] ? offsetX : 0,\n      offsetY: direction[1] ? offsetY : 0,\n      inputEvent: e\n    });\n\n    if (throttleTime) {\n      this.timer = window.setTimeout(function () {\n        _this.drag(e, options);\n      }, throttleTime);\n    }\n\n    return true;\n  };\n\n  __proto.dragEnd = function () {\n    clearTimeout(this.timer);\n  };\n\n  return DragScroll;\n}(Component);\n\nexport default DragScroll;","map":null,"metadata":{},"sourceType":"module"}