{"version":3,"file":"ruler.esm.js","sources":["../src/react-ruler/Ruler.tsx"],"sourcesContent":["import * as React from \"react\";\nimport { ref } from \"framework-utils\";\nimport { RulerInterface, RulerProps } from \"./types\";\n\nexport default class Ruler extends React.PureComponent<RulerProps> implements RulerInterface {\n    public static defaultProps = {\n        type: \"horizontal\",\n        zoom: 1,\n        width: 0,\n        height: 0,\n        unit: 50,\n        style: { width: \"100%\", height: \"100%\" },\n        backgroundColor: \"#333333\",\n        textColor: \"#ffffff\",\n        lineColor: \"#777777\",\n    };\n    public divisionsElement!: HTMLElement;\n    public state = {\n        scrollPos: 0,\n    };\n    public canvasElement!: HTMLCanvasElement;\n    private canvasContext!: CanvasRenderingContext2D;\n    private width: number = 0;\n    private height: number = 0;\n    public render() {\n        return (<canvas\n            ref={ref(this, \"canvasElement\")}\n            style={this.props.style} />);\n\n    }\n    public componentDidMount() {\n        const canvas = this.canvasElement;\n        const context = canvas.getContext(\"2d\")!;\n\n        this.canvasContext = context;\n\n        this.resize();\n    }\n    public componentDidUpdate() {\n        this.resize();\n    }\n    public scroll(scrollPos: number) {\n        this.draw(scrollPos);\n    }\n    public resize() {\n        const canvas = this.canvasElement;\n        const {\n            width,\n            height,\n        } = this.props;\n\n        this.width = width || canvas.offsetWidth;\n        this.height = height || canvas.offsetHeight;\n        canvas.width = this.width * 2;\n        canvas.height = this.height * 2;\n        this.draw();\n    }\n    private draw(scrollPos: number = this.state.scrollPos) {\n        const {\n            unit,\n            zoom,\n            type,\n            backgroundColor,\n            lineColor,\n            textColor,\n        } = this.props as Required<RulerProps>;\n        const width = this.width;\n        const height = this.height;\n        const state = this.state;\n        state.scrollPos = scrollPos;\n        const context = this.canvasContext;\n        const isHorizontal = type === \"horizontal\";\n\n        context.rect(0, 0, width * 2, height * 2);\n        context.fillStyle = backgroundColor;\n        context.fill();\n        context.save();\n        context.scale(2, 2);\n        context.strokeStyle = lineColor;\n        context.lineWidth = 1;\n        context.font = \"10px sans-serif\";\n        context.fillStyle = textColor;\n        context.translate(0.5, 0);\n        context.beginPath();\n\n        const size = isHorizontal ? width : height;\n        const zoomUnit = zoom * unit;\n        const minRange = Math.floor(scrollPos * zoom / zoomUnit);\n        const maxRange = Math.ceil((scrollPos * zoom + size) / zoomUnit);\n        const length = maxRange - minRange;\n\n        for (let i = 0; i < length; ++i) {\n            const startPos = ((i + minRange) * unit - scrollPos) * zoom;\n\n            if (startPos >= -zoomUnit && startPos < size) {\n                const startX = isHorizontal ? startPos + 3 : width - 18;\n                const startY = isHorizontal ? height - 18 : startPos - 4;\n\n                if (isHorizontal) {\n                    context.fillText(`${(i + minRange) * unit}`, startX, startY);\n                } else {\n                    context.save();\n                    context.translate(startX, startY);\n                    context.rotate(-Math.PI / 2);\n                    context.fillText(`${(i + minRange) * unit}`, 0, 0);\n                    context.restore();\n                }\n            }\n\n            for (let j = 0; j < 10; ++j) {\n                const pos = startPos + j / 10 * zoomUnit;\n\n                if (pos < 0 || pos >= size) {\n                    continue;\n                }\n                const lineSize = j === 0\n                    ? isHorizontal ? height : width\n                    : (j % 2 === 0 ? 10 : 7);\n\n                const x1 = isHorizontal ? pos : width - lineSize;\n                const x2 = isHorizontal ? pos : width;\n                const y1 = isHorizontal ? height - lineSize : pos;\n                const y2 = isHorizontal ? height : pos;\n                context.moveTo(x1, y1);\n                context.lineTo(x2, y2);\n            }\n        }\n        context.stroke();\n        context.restore();\n    }\n}\n"],"names":["tslib_1","_this","scrollPos","React","ref","style","props","canvas","canvasElement","context","getContext","canvasContext","resize","draw","_a","width","height","offsetWidth","offsetHeight","state","unit","zoom","type","backgroundColor","lineColor","textColor","isHorizontal","rect","fillStyle","fill","save","scale","strokeStyle","lineWidth","font","translate","beginPath","size","zoomUnit","minRange","Math","floor","maxRange","ceil","length","i","startPos","startX","startY","fillText","rotate","PI","restore","j","pos","lineSize","x1","x2","y1","y2","moveTo","lineTo","stroke","Ruler"],"mappings":"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"}